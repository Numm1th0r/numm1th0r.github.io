<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Looper Pro - Split View</title>
    <style>
        :root {
            --bg-dark: #0d1117;
            --bg-panel: #161b22;
            --bg-light: #21262d;
            --text-main: #c9d1d9;
            --text-sub: #8b949e;
            --accent: #238636;
            --accent-hover: #2ea043;
            --danger: #da3633;
            --loop-color: #f78166; 
            --timeline-bg: #30363d;
            --border: #30363d;
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Helvetica, Arial, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: grid;
            grid-template-columns: 260px 1fr; /* Sidebar | Content */
            overflow: hidden;
        }

        /* --- Oldals√°v --- */
        .sidebar {
            background-color: var(--bg-panel);
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-right: 1px solid var(--border);
            overflow-y: auto;
            z-index: 20;
        }

        .sidebar h2 { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-sub); margin-bottom: 5px; }
        
        .group-row {
            display: flex; align-items: center; justify-content: space-between;
            padding: 8px 10px; cursor: pointer; border-radius: 6px; color: var(--text-sub); transition: 0.2s;
            font-size: 14px; font-weight: 500;
        }
        .group-row:hover { color: var(--text-main); background: var(--bg-light); }
        .group-row.active { background-color: var(--bg-light); color: var(--text-main); border-left: 3px solid var(--accent); }
        
        .group-delete-btn {
            background: transparent; border: none; color: var(--text-sub); opacity: 0; transition: 0.2s; cursor: pointer; padding: 2px 6px;
        }
        .group-row:hover .group-delete-btn { opacity: 1; }
        .group-delete-btn:hover { color: var(--danger); transform: scale(1.1); }

        .sidebar-btn {
            background: var(--bg-light); border: 1px solid var(--border); color: var(--text-main);
            padding: 8px; cursor: pointer; border-radius: 6px; margin-top: 5px; font-size: 13px;
            transition: 0.2s; text-align: center; width: 100%; box-sizing: border-box;
        }
        .sidebar-btn:hover { border-color: var(--text-sub); background: #30363d; }
        .sidebar-btn.primary { background: var(--accent); color: white; border: none; font-weight: bold; }
        .sidebar-btn.primary:hover { background: var(--accent-hover); }

        .sync-status { font-size: 11px; margin-top: 5px; text-align: center; color: var(--text-sub); transition: color 0.5s; }

        /* --- F≈ë Tartalom Ter√ºlet (Dinamikus) --- */
        .content-area {
            position: relative;
            overflow: hidden;
            background: var(--bg-dark);
        }

        /* N√âZETEK (Views) */
        .view-section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            padding: 30px; box-sizing: border-box;
            overflow-y: auto;
            display: none; /* Alapb√≥l rejtett */
            flex-direction: column;
        }
        .view-section.active { display: flex; }

        /* --- LISTA N√âZET ST√çLUS --- */
        .import-area { display: flex; gap: 10px; margin-bottom: 20px; align-items: flex-start; }
        .import-area textarea {
            flex: 1; background: var(--bg-dark); border: 1px solid var(--border); color: white; padding: 10px;
            border-radius: 6px; resize: vertical; min-height: 38px; font-family: inherit;
        }
        .import-area textarea:focus { border-color: var(--text-sub); outline: none; }

        table { width: 100%; border-collapse: collapse; font-size: 14px; margin-top: 20px; }
        th { text-align: left; color: var(--text-sub); border-bottom: 1px solid var(--border); padding: 10px; font-weight: normal; font-size: 12px;}
        td { padding: 12px 10px; border-bottom: 1px solid var(--bg-light); }
        tr:hover { background-color: var(--bg-light); cursor: pointer; }
        
        .action-btn {
            background: transparent; border: 1px solid var(--border); color: var(--text-main); 
            cursor: pointer; font-size: 11px; padding: 4px 8px; border-radius: 4px;
        }
        .action-btn:hover { border-color: var(--text-sub); }
        .btn-delete { border-color: #3d1c1c; color: #ff5555; }
        .btn-delete:hover { border-color: #ff5555; background: rgba(255, 85, 85, 0.1); }

        /* --- PLAYER N√âZET ST√çLUS --- */
        .back-btn {
            align-self: flex-start; margin-bottom: 20px;
            background: transparent; border: none; color: var(--text-sub); font-size: 16px; cursor: pointer; display: flex; align-items: center; gap: 5px;
        }
        .back-btn:hover { color: white; text-decoration: underline; }

        .video-container {
            width: 100%; max-width: 900px; aspect-ratio: 16 / 9; background: #000;
            margin: 0 auto 20px auto; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.6);
        }
        .video-container iframe { width: 100%; height: 100%; border: none; }

        /* Player Controls Panel (Most m√°r a view r√©sze) */
        .player-panel {
            background-color: var(--bg-panel); border: 1px solid var(--border); border-radius: 12px;
            padding: 20px; width: 100%; max-width: 900px; margin: 0 auto;
            display: flex; flex-direction: column; gap: 15px; box-sizing: border-box;
        }

        .video-info { text-align: center; }
        .video-title { font-size: 18px; font-weight: bold; margin-bottom: 5px; color: white; }
        .video-time { color: var(--accent); font-family: monospace; }

        .timeline-container {
            width: 100%; height: 8px; position: relative; background: var(--timeline-bg); border-radius: 4px; cursor: pointer; margin: 10px 0;
        }
        .loop-region {
            position: absolute; height: 100%; background: var(--loop-color); opacity: 0.6; border-radius: 4px; pointer-events: none;
        }
        .play-progress {
            position: absolute; height: 100%; background: white; border-radius: 4px; pointer-events: none; width: 0%;
        }

        .controls-row { display: flex; justify-content: space-between; align-items: center; }
        
        .ab-controls { display: flex; gap: 10px; }
        .ab-btn {
            background: var(--bg-light); border: 1px solid var(--border); color: var(--text-sub);
            padding: 8px 15px; border-radius: 6px; cursor: pointer;
            font-size: 14px; font-family: monospace; display: flex; flex-direction: column; align-items: center; min-width: 70px;
        }
        .ab-btn:hover { border-color: var(--text-main); color: var(--text-main); }
        .ab-btn.set { border-color: var(--loop-color); color: var(--loop-color); background: rgba(247, 129, 102, 0.1); }

        .main-transport { display: flex; align-items: center; gap: 20px; }
        .btn-circle {
            width: 50px; height: 50px; border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 24px; cursor: pointer; background: white; color: black; transition: transform 0.2s;
        }
        .btn-circle:hover { transform: scale(1.1); }
        
        .speed-btn { background: transparent; border: none; color: var(--text-sub); cursor: pointer; font-size: 20px; }

    </style>
</head>
<body>

    <div class="sidebar">
        <h2>Csoportok</h2>
        <div style="flex-grow: 1; overflow-y: auto; margin-top:5px;" id="group-list"></div>
        <button class="sidebar-btn primary" onclick="createNewGroup()">+ √öj Csoport</button>

        <div style="border-top: 1px solid var(--border); padding-top: 15px; margin-top: 10px;">
            <h2>Felh≈ë Szinkron (GitHub)</h2>
            <div id="github-auth-area">
                <button class="sidebar-btn" onclick="setupGitHub()">üîë Token Be√°ll√≠t√°sa</button>
            </div>
            
            <div style="display:flex; gap:5px; margin-top:5px;">
                <button class="sidebar-btn" onclick="loadFromGitHub()" title="Bet√∂lt√©s GitHubr√≥l">‚òÅÔ∏è Bet√∂lt</button>
                <button class="sidebar-btn" onclick="saveToGitHub(false)" title="Ment√©s GitHubra">üíæ Ment√©s</button>
            </div>
            <div id="sync-status" class="sync-status">Szinkroniz√°ci√≥ra v√°r</div>
        </div>
    </div>

    <div class="content-area">

        <div id="view-list" class="view-section active">
            <h1 id="current-group-title" style="margin: 0 0 20px 0; font-size: 24px;">K√∂nyvt√°r</h1>

            <div class="import-area">
                <textarea id="import-url" rows="1" placeholder="Illessz be YouTube linkeket (soronk√©nt)..."></textarea>
                <button class="sidebar-btn primary" style="width: auto; margin:0; height: 42px;" onclick="addVideosBulk()">Hozz√°ad</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Vide√≥ C√≠me</th>
                        <th style="width: 100px; text-align:right;">Kezel√©s</th>
                    </tr>
                </thead>
                <tbody id="video-list-body"></tbody>
            </table>
        </div>

        <div id="view-player" class="view-section">
            <button class="back-btn" onclick="setView('list')">‚Üê Vissza a list√°hoz</button>
            
            <div class="video-container">
                <div id="player"></div>
            </div>

            <div class="player-panel">
                <div class="video-info">
                    <div class="video-title" id="now-playing-title">Bet√∂lt√©s...</div>
                    <div class="video-time" id="time-display">00:00 / 00:00</div>
                </div>

                <div class="timeline-container" id="timeline" onclick="seekClick(event)">
                    <div class="loop-region" id="loop-region" style="left: 0%; width: 0%; display:none;"></div>
                    <div class="play-progress" id="play-progress"></div>
                </div>

                <div class="controls-row">
                    <div class="ab-controls">
                        <button class="ab-btn" id="btn-a" onclick="setA()">SET A<span id="label-a">--:--</span></button>
                        <button class="ab-btn" id="btn-b" onclick="setB()">SET B<span id="label-b">--:--</span></button>
                        <button class="action-btn btn-delete" onclick="clearLoop()" style="border:1px solid #555;">T√∂rl√©s</button>
                    </div>

                    <div class="main-transport">
                        <button class="speed-btn" onclick="skip(-5)">‚Ü∫ 5s</button>
                        <button class="btn-circle" onclick="togglePlay()"><span id="play-icon">‚ñ∂</span></button>
                        <button class="speed-btn" onclick="skip(5)">5s ‚Üª</button>
                    </div>

                    <div style="display:flex; align-items:center; gap:10px;">
                         <label style="font-size:12px; color:#aaa;"><input type="checkbox" id="chk-loop" checked> Auto Loop</label>
                         <button class="speed-btn" onclick="changeSpeed(-0.1)">-</button>
                         <span class="speed-val" id="speed-val" style="font-family:monospace; width:30px; text-align:center;">1.0</span>
                         <button class="speed-btn" onclick="changeSpeed(0.1)">+</button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <script>
        // --- KONFIGUR√ÅCI√ì ---
        const REPO_OWNER = "Numm1th0r";
        const REPO_NAME = "numm1th0r.github.io";
        const FILE_PATH = "saves.txt";

        // --- Adatstrukt√∫ra ---
        let groups = [ { id: 1, name: 'Kezd≈ë Lista', videos: [] } ];
        let currentGroupId = 1;
        let player, duration = 0, loopStart = null, loopEnd = null, updateInterval;
        let ghToken = localStorage.getItem("yt_looper_gh_token");
        let latestSha = null;

        window.onload = function() {
            const localData = localStorage.getItem('yt_looper_data_v5');
            if(localData) { try { groups = JSON.parse(localData); } catch(e) {} }
            // Ha nincs csoport, hozzunk l√©tre egyet
            if(groups.length === 0) groups.push({ id: Date.now(), name: 'Kezd≈ë Lista', videos: [] });
            currentGroupId = groups[0].id;

            renderGroups(); renderVideos();
            if(ghToken) {
                document.getElementById('sync-status').innerText = "GitHub Akt√≠v";
                document.getElementById('sync-status').style.color = "#238636";
                loadFromGitHub(true); 
            }
            setInterval(() => { if(ghToken) saveToGitHub(true); }, 300000);
        };

        window.addEventListener('beforeunload', () => { saveToLocalStorage(); if(ghToken) saveToGitHub(true); });

        // --- N√âZET KEZEL√âS (√öJ) ---
        function setView(viewName) {
            document.querySelectorAll('.view-section').forEach(el => el.classList.remove('active'));
            document.getElementById(`view-${viewName}`).classList.add('active');
            
            if(viewName === 'list') {
                // Ha visszal√©p√ºnk a list√°hoz, opcion√°lisan meg√°ll√≠thatjuk a vide√≥t, 
                // de sokan szeretik ha sz√≥l k√∂zben. Most hagyjuk sz√≥lni.
            }
        }

        // --- CSOPORT KEZEL√âS (√öJ: T√ñRL√âS) ---
        function createNewGroup() { 
            const name = prompt("Csoport neve:"); 
            if(name) { 
                const newId = Date.now();
                groups.push({ id: newId, name: name, videos: [] }); 
                currentGroupId = newId;
                saveToLocalStorage(); renderGroups(); renderVideos(); 
                setView('list');
            } 
        }

        function deleteGroup(id, event) {
            event.stopPropagation(); // Ne v√°lassza ki a csoportot, ha a t√∂rl√©sre kattintunk
            if(confirm("Biztosan t√∂rl√∂d ezt a csoportot √©s az √∂sszes benne l√©v≈ë dalt?")) {
                groups = groups.filter(g => g.id !== id);
                // Ha az akt√≠v csoportot t√∂r√∂lt√ºk, ugorjunk az els≈ëre
                if(currentGroupId === id) {
                    currentGroupId = groups.length > 0 ? groups[0].id : null;
                }
                if(groups.length === 0) {
                    // Ha mindent t√∂r√∂lt, csin√°ljunk egy √ºreset
                    groups.push({ id: Date.now(), name: '√öj Lista', videos: [] });
                    currentGroupId = groups[0].id;
                }
                saveToLocalStorage();
                renderGroups();
                renderVideos();
            }
        }

        function renderGroups() {
            const list = document.getElementById('group-list'); list.innerHTML = '';
            groups.forEach(g => {
                const div = document.createElement('div'); 
                div.className = `group-row ${g.id === currentGroupId ? 'active' : ''}`;
                
                div.innerHTML = `
                    <span style="flex-grow:1;">${g.name}</span>
                    <button class="group-delete-btn" onclick="deleteGroup(${g.id}, event)" title="Csoport t√∂rl√©se">üóëÔ∏è</button>
                `;
                div.onclick = () => { 
                    currentGroupId = g.id; 
                    renderGroups(); 
                    renderVideos(); 
                    setView('list'); // Csoport v√°lt√°skor menj√ºnk a list√°ra
                }; 
                list.appendChild(div);
            });
            const activeGrp = groups.find(g => g.id === currentGroupId);
            document.getElementById('current-group-title').innerText = activeGrp ? activeGrp.name : 'K√∂nyvt√°r';
        }

        // --- VIDE√ì LISTA ---
        function renderVideos() {
            const tbody = document.getElementById('video-list-body'); tbody.innerHTML = '';
            const group = groups.find(g => g.id === currentGroupId); 
            if(!group) return;

            group.videos.forEach((vid, idx) => {
                const tr = document.createElement('tr');
                // Kattint√°sra indul a vide√≥ √©s v√°lt a n√©zet
                tr.onclick = (e) => {
                    // Ha a t√∂rl√©s gombra kattintott, ne ind√≠tsa el
                    if(e.target.classList.contains('btn-delete')) return;
                    playVideo(vid.id, vid.title);
                };

                tr.innerHTML = `
                    <td style="color:#666">${idx+1}</td>
                    <td>${vid.title}</td>
                    <td style="text-align:right;">
                        <button class="action-btn btn-delete" onclick="deleteVideo(${idx})">T√∂rl√©s</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- PLAYER LOGIC ---
        function playVideo(id, title) {
            setView('player'); // V√°lt√°s Player n√©zetre
            if(player && player.loadVideoById) {
                player.loadVideoById(id);
            } else {
                // Ha m√©g nincs k√©sz a player, ments√ºk el k√©s≈ëbbre (ritka)
            }
            document.getElementById('now-playing-title').innerText = title;
            clearLoop();
        }

        // --- BULK ADD ---
        async function addVideosBulk() {
            const input = document.getElementById('import-url');
            const text = input.value; if (!text.trim()) return;
            const lines = text.split(/\r?\n/);
            const group = groups.find(g => g.id === currentGroupId);
            const videosToFetch = [];

            for (const line of lines) {
                const id = extractVideoID(line);
                if (id) {
                    const newVideo = { id: id, title: "C√≠m bet√∂lt√©se...", addedAt: Date.now() + Math.random() };
                    group.videos.push(newVideo);
                    videosToFetch.push({ videoObj: newVideo, url: line });
                }
            }
            input.value = ''; saveToLocalStorage(); renderVideos();

            for (const item of videosToFetch) {
                const realTitle = await fetchVideoTitle(item.url);
                item.videoObj.title = realTitle || `Vide√≥ (${item.videoObj.id})`;
                renderVideos();
            }
            saveToLocalStorage();
        }

        // --- SYNC & UTIL ---
        function setupGitHub() {
            const token = prompt("GitHub Token:");
            if(token) { ghToken = token; localStorage.setItem("yt_looper_gh_token", token); loadFromGitHub(true); }
        }
        async function loadFromGitHub(silent) {
            if(!ghToken) return silent ? null : setupGitHub();
            if(!silent) document.getElementById('sync-status').innerText = "Bet√∂lt√©s...";
            try {
                const url = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}?t=${Date.now()}`;
                const res = await fetch(url, { headers: { 'Authorization': `token ${ghToken}` } });
                if(!res.ok) throw new Error();
                const data = await res.json(); latestSha = data.sha;
                groups = JSON.parse(decodeURIComponent(escape(window.atob(data.content))));
                saveToLocalStorage(); renderGroups(); renderVideos();
                document.getElementById('sync-status').innerText = "‚úÖ Szinkroniz√°lva";
            } catch(e) { if(!silent) alert("Hiba!"); }
        }
        async function saveToGitHub(silent) {
            if(!ghToken) return silent ? null : setupGitHub();
            if(!silent) document.getElementById('sync-status').innerText = "Ment√©s...";
            try {
                const apiUrl = `https://api.github.com/repos/${REPO_OWNER}/${REPO_NAME}/contents/${FILE_PATH}`;
                if(!latestSha) { try { const r = await fetch(apiUrl, { headers: {'Authorization': `token ${ghToken}`} }); if(r.ok) latestSha = (await r.json()).sha; } catch(e){} }
                const body = { message: "Update", content: window.btoa(unescape(encodeURIComponent(JSON.stringify(groups)))), sha: latestSha };
                const res = await fetch(apiUrl, { method:'PUT', headers: {'Authorization': `token ${ghToken}`}, body: JSON.stringify(body) });
                if(res.ok) { latestSha = (await res.json()).content.sha; document.getElementById('sync-status').innerText = "‚úÖ Szinkroniz√°lva"; }
            } catch(e) {}
        }
        
        function saveToLocalStorage() { localStorage.setItem('yt_looper_data_v5', JSON.stringify(groups)); }
        function extractVideoID(url) { var match = url.match(/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/); return (match && match[2].length == 11) ? match[2] : null; }
        async function fetchVideoTitle(url) { try { const r = await fetch(`https://noembed.com/embed?url=${url}`); return (await r.json()).title; } catch(e){return null;} }
        
        // --- PLAYER CORE ---
        var tag = document.createElement('script'); tag.src = "https://www.youtube.com/iframe_api";
        document.body.appendChild(tag);
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', { height: '100%', width: '100%', videoId: '', playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 }, events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange } });
        }
        function onPlayerReady() { setInterval(loopLogic, 100); }
        function onPlayerStateChange(e) { 
            if(e.data == YT.PlayerState.PLAYING) { 
                document.getElementById('play-icon').innerHTML = "‚ùö‚ùö"; 
                duration = player.getDuration(); 
            } else document.getElementById('play-icon').innerHTML = "‚ñ∂"; 
        }
        function loopLogic() {
            if(!player || !player.getCurrentTime) return;
            const ct = player.getCurrentTime();
            if(duration > 0) {
                document.getElementById('time-display').innerText = formatTime(ct) + " / " + formatTime(duration);
                document.getElementById('play-progress').style.width = ((ct/duration)*100)+"%";
            }
            if(document.getElementById('chk-loop').checked && loopStart!=null && loopEnd!=null) {
                if(ct >= loopEnd || (ct < loopStart && Math.abs(ct-loopStart)>2)) player.seekTo(loopStart);
            }
        }
        function setA() { loopStart = player.getCurrentTime(); updateLoopVisuals(); }
        function setB() { loopEnd = player.getCurrentTime(); if(loopStart!=null && loopEnd<loopStart) loopStart=0; updateLoopVisuals(); }
        function clearLoop() { loopStart=null; loopEnd=null; updateLoopVisuals(); }
        function updateLoopVisuals() {
            const r = document.getElementById('loop-region');
            const aBtn = document.getElementById('btn-a'); const bBtn = document.getElementById('btn-b');
            if(loopStart!=null) { aBtn.classList.add('set'); document.getElementById('label-a').innerText = formatTime(loopStart); } else { aBtn.classList.remove('set'); document.getElementById('label-a').innerText = "--:--"; }
            if(loopEnd!=null) { bBtn.classList.add('set'); document.getElementById('label-b').innerText = formatTime(loopEnd); } else { bBtn.classList.remove('set'); document.getElementById('label-b').innerText = "--:--"; }
            if(loopStart!=null && loopEnd!=null && duration>0) { r.style.display="block"; r.style.left=(loopStart/duration)*100+"%"; r.style.width=((loopEnd-loopStart)/duration)*100+"%"; } else r.style.display="none";
        }
        function formatTime(s) { const m=Math.floor(s/60), sc=Math.floor(s%60); return (m<10?"0"+m:m)+":"+(sc<10?"0"+sc:sc); }
        function seekClick(e) { const r = e.currentTarget.getBoundingClientRect(); player.seekTo(((e.clientX-r.left)/r.width)*duration); }
        function deleteVideo(idx) { if(confirm("T√∂rl√©s?")) { groups.find(g=>g.id===currentGroupId).videos.splice(idx,1); saveToLocalStorage(); renderVideos(); } }
        function togglePlay() { if(player.getPlayerState()==1) player.pauseVideo(); else player.playVideo(); }
        function skip(s) { player.seekTo(player.getCurrentTime()+s); }
        function changeSpeed(d) { let n = Math.round((Math.max(0.25, Math.min(2.0, player.getPlaybackRate() + d)))*100)/100; player.setPlaybackRate(n); document.getElementById('speed-val').innerText = n; }

    </script>
</body>
</html>
