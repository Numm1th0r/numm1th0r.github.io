<!DOCTYPE html>
<html lang="hu">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YT Looper Pro - Set A/B</title>
    <style>
        :root {
            --bg-dark: #121212;
            --bg-panel: #181818;
            --bg-light: #282828;
            --text-main: #ffffff;
            --text-sub: #b3b3b3;
            --accent: #1db954; /* Spotify z√∂ld */
            --loop-color: #ff4081; 
            --timeline-bg: #535353;
        }

        body {
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-dark);
            color: var(--text-main);
            height: 100vh;
            display: grid;
            grid-template-rows: 1fr 160px; /* Megn√∂velt als√≥ s√°v */
            overflow: hidden;
        }

        /* --- F≈ë elrendez√©s --- */
        .main-container {
            display: grid;
            grid-template-columns: 250px 1fr;
            overflow: hidden;
            height: 100%;
        }

        /* --- Oldals√°v --- */
        .sidebar {
            background-color: black;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 10px;
            border-right: 1px solid #333;
            overflow-y: auto;
        }

        .sidebar h2 { font-size: 12px; text-transform: uppercase; letter-spacing: 2px; color: var(--text-sub); margin-bottom: 5px; }
        
        .group-item {
            padding: 10px;
            cursor: pointer;
            border-radius: 4px;
            color: var(--text-sub);
            transition: 0.2s;
            font-size: 14px;
            font-weight: 500;
        }
        .group-item:hover { color: white; background: #222; }
        .group-item.active { background-color: var(--bg-light); color: white; border-left: 3px solid var(--accent); }
        
        .sidebar-btn {
            background: transparent; border: 1px solid #444; color: var(--text-sub);
            padding: 8px; cursor: pointer; border-radius: 4px; margin-top: 5px; font-size: 12px;
            transition: 0.2s; text-align: center;
        }
        .sidebar-btn:hover { border-color: white; color: white; }
        .sidebar-btn.primary { background: var(--text-main); color: black; border: none; font-weight: bold; }
        .sidebar-btn.primary:hover { background: #ddd; }

        /* File Input elrejt√©se */
        #file-input { display: none; }

        /* --- Tartalom --- */
        .content-area {
            background: linear-gradient(to bottom, #2a2a2a, #121212);
            padding: 30px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
        }

        .video-container {
            width: 100%;
            max-width: 700px;
            aspect-ratio: 16 / 9;
            background: #000;
            margin: 0 auto 20px auto;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            display: none; 
        }
        
        .video-container iframe { width: 100%; height: 100%; border: none; }

        .header-controls { margin-bottom: 20px; border-bottom: 1px solid #333; padding-bottom: 10px;}
        
        .import-area { display: flex; gap: 10px; margin-bottom: 20px; }
        .import-area input {
            flex: 1; background: var(--bg-light); border: 1px solid #444; color: white; padding: 10px;
            border-radius: 4px;
        }
        
        table { width: 100%; border-collapse: collapse; font-size: 14px; }
        th { text-align: left; color: var(--text-sub); border-bottom: 1px solid #333; padding: 10px; font-weight: normal; font-size: 12px;}
        td { padding: 12px 10px; border-bottom: 1px solid #222; }
        tr:hover { background-color: rgba(255,255,255,0.05); }
        
        .action-btn {
            background: transparent; border: 1px solid #555; color: white; 
            cursor: pointer; font-size: 11px; padding: 4px 8px; border-radius: 4px;
        }
        .action-btn:hover { border-color: white; }
        .btn-delete { border-color: #555; color: #ff5555; }
        .btn-delete:hover { border-color: #ff5555; background: rgba(255, 85, 85, 0.1); }

        /* --- Lej√°tsz√≥ S√°v (√öJ DESIGN) --- */
        .player-bar {
            background-color: var(--bg-panel);
            border-top: 1px solid #333;
            padding: 0 20px;
            display: grid;
            grid-template-columns: 1fr 2fr 1fr;
            align-items: center;
            z-index: 10;
        }

        .video-info { overflow: hidden; white-space: nowrap; }
        .video-title { display: block; overflow: hidden; text-overflow: ellipsis; margin-bottom: 4px; color: white; font-weight: bold;}
        .video-time { color: var(--accent); font-family: monospace; font-size: 14px; }

        /* K√∂z√©ps≈ë r√©sz: Timeline + AB Gombok */
        .player-center {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        /* Timeline (csak vizu√°lis) */
        .timeline-container {
            width: 100%;
            height: 6px;
            position: relative;
            background: var(--timeline-bg);
            border-radius: 3px;
            cursor: pointer; /* Lehessen kattintani a keres√©shez */
        }

        .loop-region {
            position: absolute; height: 100%; background: var(--loop-color);
            opacity: 0.6; border-radius: 3px; pointer-events: none;
            transition: all 0.2s;
        }
        .play-progress {
            position: absolute; height: 100%; background: white;
            border-radius: 3px; pointer-events: none; width: 0%;
            box-shadow: 0 0 5px rgba(255,255,255,0.5);
        }

        /* AB Vez√©rl≈ëk */
        .ab-controls {
            display: flex;
            align-items: center;
            gap: 15px;
            background: #222;
            padding: 8px 20px;
            border-radius: 30px;
            border: 1px solid #333;
        }

        .ab-btn {
            background: #333; border: 1px solid #555; color: #ccc;
            padding: 5px 12px; border-radius: 4px; cursor: pointer;
            font-size: 12px; font-family: monospace; display: flex; flex-direction: column; align-items: center;
            min-width: 60px;
        }
        .ab-btn span { font-size: 10px; color: #888; margin-top: 2px;}
        .ab-btn:hover { background: #444; color: white; border-color: #888; }
        .ab-btn:active { transform: scale(0.95); }
        
        .ab-btn.set { border-color: var(--loop-color); color: var(--loop-color); background: rgba(255, 64, 129, 0.1); }
        .ab-btn.set span { color: var(--loop-color); }

        .main-controls { display: flex; gap: 15px; align-items: center; }
        .btn-circle {
            width: 35px; height: 35px; border-radius: 50%; border: none;
            display: flex; align-items: center; justify-content: center;
            font-size: 16px; cursor: pointer; background: white; color: black;
            transition: transform 0.2s;
        }
        .btn-circle:hover { transform: scale(1.1); }
        
        .btn-clear {
            background: transparent; border: none; color: #666; font-size: 18px; cursor: pointer;
        }
        .btn-clear:hover { color: #ff5555; }

        /* Sebess√©g */
        .player-right { display: flex; justify-content: flex-end; align-items: center; gap: 5px; }
        .speed-btn { background: transparent; border: none; color: #aaa; cursor: pointer; font-size: 18px; }
        .speed-val { font-family: monospace; width: 40px; text-align: center; font-size: 14px; }

    </style>
</head>
<body>

    <div class="main-container">
        <div class="sidebar">
            <h2 style="font-size:16px; color:white; margin-bottom: 20px;">My Loops</h2>
            
            <button class="sidebar-btn primary" onclick="createNewGroup()">+ √öj Csoport</button>
            
            <div style="flex-grow: 1; overflow-y: auto; margin-top:10px;" id="group-list">
                </div>

            <div style="border-top: 1px solid #333; padding-top: 10px; margin-top: 10px;">
                <h2>Adatb√°zis</h2>
                <button class="sidebar-btn" style="width:100%" onclick="saveToFile()">üíæ Ment√©s F√°jlba (TXT)</button>
                <button class="sidebar-btn" style="width:100%" onclick="document.getElementById('file-input').click()">üìÇ Bet√∂lt√©s F√°jlb√≥l</button>
                <input type="file" id="file-input" accept=".txt,.json" onchange="loadFromFile(this)">
            </div>
        </div>

        <div class="content-area">
            
            <div id="video-wrapper" class="video-container">
                <div id="player"></div>
            </div>

            <div class="header-controls">
                <h1 id="current-group-title" style="margin:0; font-size: 22px;">K√∂nyvt√°r</h1>
            </div>

            <div class="import-area">
                <input type="text" id="import-url" placeholder="YouTube Link beilleszt√©se..." onkeydown="if(event.key==='Enter') addVideo()">
                <button class="sidebar-btn primary" onclick="addVideo()">Hozz√°ad</button>
            </div>

            <table>
                <thead>
                    <tr>
                        <th style="width: 30px;">#</th>
                        <th>Vide√≥ C√≠me</th>
                        <th style="width: 140px; text-align:right;">Kezel√©s</th>
                    </tr>
                </thead>
                <tbody id="video-list-body"></tbody>
            </table>
        </div>
    </div>

    <div class="player-bar">
        
        <div class="video-info">
            <div class="video-title" id="now-playing-title">Nincs vide√≥</div>
            <div class="video-time" id="time-display">00:00 / 00:00</div>
        </div>

        <div class="player-center">
            
            <div class="timeline-container" id="timeline" onclick="seekClick(event)">
                <div class="loop-region" id="loop-region" style="left: 0%; width: 0%; display:none;"></div>
                <div class="play-progress" id="play-progress"></div>
            </div>

            <div class="ab-controls">
                <button class="ab-btn" id="btn-a" onclick="setA()">
                    SET A
                    <span id="label-a">--:--</span>
                </button>

                <button class="ab-btn" id="btn-b" onclick="setB()">
                    SET B
                    <span id="label-b">--:--</span>
                </button>

                <button class="btn-clear" onclick="clearLoop()" title="Loop T√∂rl√©se">‚úï</button>

                <div style="width: 1px; height: 20px; background: #444; margin: 0 10px;"></div>

                <div class="main-controls">
                    <button class="speed-btn" onclick="skip(-5)">‚Ü∫</button>
                    <button class="btn-circle" onclick="togglePlay()">
                        <span id="play-icon">‚ñ∂</span>
                    </button>
                    <button class="speed-btn" onclick="skip(5)">‚Üª</button>
                </div>
            </div>
            
            <div style="font-size: 11px; color: #666; margin-top: 5px;">
                <label><input type="checkbox" id="chk-loop" checked> Automatikus Loop</label>
            </div>

        </div>

        <div class="player-right">
            <button class="speed-btn" onclick="changeSpeed(-0.1)">-</button>
            <span class="speed-val" id="speed-val">1.0</span>
            <button class="speed-btn" onclick="changeSpeed(0.1)">+</button>
        </div>
    </div>

    <script>
        // --- Adatstrukt√∫ra ---
        let groups = [
            { id: 1, name: 'Kedvencek', videos: [] }
        ];
        let currentGroupId = 1;
        
        // --- Player √Ållapot ---
        let player; 
        let duration = 0;
        let loopStart = null;
        let loopEnd = null;
        let isLoopActive = false;
        let updateInterval;

        // --- Inicializ√°l√°s ---
        window.onload = function() {
            loadFromLocalStorage(); // Adatok bet√∂lt√©se b√∂ng√©sz≈ëb≈ël
            renderGroups();
            renderVideos();
        };

        // --- YouTube API ---
        var tag = document.createElement('script');
        tag.src = "https://www.youtube.com/iframe_api";
        var firstScriptTag = document.getElementsByTagName('script')[0];
        firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

        function onYouTubeIframeAPIReady() {
            player = new YT.Player('player', {
                height: '100%', width: '100%', videoId: '',
                playerVars: { 'playsinline': 1, 'controls': 0, 'rel': 0 }, // controls: 0 = saj√°t UI-t haszn√°lunk
                events: { 'onReady': onPlayerReady, 'onStateChange': onPlayerStateChange }
            });
        }

        function onPlayerReady(event) {
            updateInterval = setInterval(loopLogic, 100);
        }

        function onPlayerStateChange(event) {
            if (event.data == YT.PlayerState.PLAYING) {
                document.getElementById('play-icon').innerHTML = "‚ùö‚ùö";
                document.getElementById('video-wrapper').style.display = "block";
                duration = player.getDuration();
            } else {
                document.getElementById('play-icon').innerHTML = "‚ñ∂";
            }
        }

        // --- F≈ë Logika: LOOP & UI ---
        function loopLogic() {
            if (!player || !player.getCurrentTime) return;
            
            const ct = player.getCurrentTime();
            
            // UI Friss√≠t√©s (Id≈ë √©s Progress bar)
            if(duration > 0) {
                document.getElementById('time-display').innerText = formatTime(ct) + " / " + formatTime(duration);
                document.getElementById('play-progress').style.width = ((ct / duration) * 100) + "%";
            }

            // Loop Mechanizmus
            const autoLoop = document.getElementById('chk-loop').checked;
            
            // Csak akkor loopolunk, ha be van √°ll√≠tva A √©s B pont is
            if (autoLoop && loopStart !== null && loopEnd !== null) {
                if (ct >= loopEnd || (ct < loopStart && Math.abs(ct-loopStart) > 2)) {
                    player.seekTo(loopStart);
                }
            }
        }

        // --- SET A / SET B Funkci√≥k ---
        function setA() {
            if (!player) return;
            loopStart = player.getCurrentTime();
            updateLoopVisuals();
        }

        function setB() {
            if (!player) return;
            loopEnd = player.getCurrentTime();
            // Ha B kisebb mint A, akkor cser√©lj√ºk meg vagy jelezz√ºnk hib√°t? Most felt√©telezz√ºk, hogy a felhaszn√°l√≥ sorban nyomja.
            if (loopStart !== null && loopEnd < loopStart) {
                 // Ha v√©letlen√ºl el≈ër√©bb nyomta a B-t, legyen az A a 0.
                 loopStart = 0; 
            }
            updateLoopVisuals();
        }

        function clearLoop() {
            loopStart = null;
            loopEnd = null;
            updateLoopVisuals();
        }

        function updateLoopVisuals() {
            const region = document.getElementById('loop-region');
            const btnA = document.getElementById('btn-a');
            const btnB = document.getElementById('btn-b');
            const lblA = document.getElementById('label-a');
            const lblB = document.getElementById('label-b');

            // Gombok √°llapota
            if (loopStart !== null) {
                btnA.classList.add('set');
                lblA.innerText = formatTime(loopStart);
            } else {
                btnA.classList.remove('set');
                lblA.innerText = "--:--";
            }

            if (loopEnd !== null) {
                btnB.classList.add('set');
                lblB.innerText = formatTime(loopEnd);
            } else {
                btnB.classList.remove('set');
                lblB.innerText = "--:--";
            }

            // Timeline S√°v rajzol√°sa
            if (loopStart !== null && loopEnd !== null && duration > 0) {
                region.style.display = "block";
                const startP = (loopStart / duration) * 100;
                const endP = (loopEnd / duration) * 100;
                region.style.left = startP + "%";
                region.style.width = (endP - startP) + "%";
            } else {
                region.style.display = "none";
            }
        }

        // --- Vide√≥ Kezel√©s ---
        function playVideo(id, title) {
            player.loadVideoById(id);
            document.getElementById('now-playing-title').innerText = title;
            clearLoop(); // √öj vide√≥n√°l t√∂r√∂lj√ºk a loopot
        }

        function seekClick(e) {
            if (!player || duration === 0) return;
            const rect = e.currentTarget.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const percent = x / rect.width;
            player.seekTo(percent * duration);
        }

        // --- Csoport & Vide√≥ Adatkezel√©s ---
        function addVideo() {
            const url = document.getElementById('import-url').value;
            const id = extractVideoID(url);
            if(id) {
                const group = groups.find(g => g.id === currentGroupId);
                group.videos.push({ id: id, title: `Vide√≥ (${id})` });
                document.getElementById('import-url').value = '';
                saveToLocalStorage();
                renderVideos();
            } else {
                alert("Hib√°s YouTube link!");
            }
        }

        function deleteVideo(idx) {
            if(confirm("T√∂rl√∂d a vide√≥t?")) {
                const group = groups.find(g => g.id === currentGroupId);
                group.videos.splice(idx, 1);
                saveToLocalStorage();
                renderVideos();
            }
        }

        function createNewGroup() {
            const name = prompt("Csoport neve:");
            if(name) {
                groups.push({ id: Date.now(), name: name, videos: [] });
                saveToLocalStorage();
                renderGroups();
            }
        }

        // --- Renderel√©s ---
        function renderGroups() {
            const list = document.getElementById('group-list');
            list.innerHTML = '';
            groups.forEach(g => {
                const div = document.createElement('div');
                div.className = `group-item ${g.id === currentGroupId ? 'active' : ''}`;
                div.innerText = g.name;
                div.onclick = () => { currentGroupId = g.id; renderGroups(); renderVideos(); };
                list.appendChild(div);
            });
            const activeGroup = groups.find(g => g.id === currentGroupId);
            document.getElementById('current-group-title').innerText = activeGroup ? activeGroup.name : 'K√∂nyvt√°r';
        }

        function renderVideos() {
            const tbody = document.getElementById('video-list-body');
            tbody.innerHTML = '';
            const group = groups.find(g => g.id === currentGroupId);
            if(!group) return;

            group.videos.forEach((vid, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td style="color:#666">${idx+1}</td>
                    <td>${vid.title}</td>
                    <td style="text-align:right;">
                        <button class="action-btn" onclick="playVideo('${vid.id}', '${vid.title}')">Lej√°tsz√°s</button>
                        <button class="action-btn btn-delete" onclick="deleteVideo(${idx})">T√∂rl√©s</button>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // --- F√ÅJL MENT√âS √âS BET√ñLT√âS (Save/Load) ---
        
        function saveToLocalStorage() {
            localStorage.setItem('yt_looper_data', JSON.stringify(groups));
        }

        function loadFromLocalStorage() {
            const data = localStorage.getItem('yt_looper_data');
            if(data) {
                try { groups = JSON.parse(data); } catch(e) { console.error("Hiba a bet√∂lt√©skor"); }
            }
        }

        // TXT / JSON F√°jlba ment√©s
        function saveToFile() {
            const dataStr = JSON.stringify(groups, null, 2); // Sz√©p form√°tum
            const blob = new Blob([dataStr], { type: "text/plain" });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = "youtube_csoportok.txt"; // A k√©r√©snek megfelel≈ëen txt
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // F√°jlb√≥l bet√∂lt√©s
        function loadFromFile(input) {
            const file = input.files[0];
            if(!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const content = e.target.result;
                    groups = JSON.parse(content);
                    saveToLocalStorage(); // Ment√©s egyb≈ël a b√∂ng√©sz≈ëbe is
                    renderGroups();
                    renderVideos();
                    alert("Sikeres bet√∂lt√©s!");
                } catch(err) {
                    alert("Hiba a f√°jl olvas√°sakor! Biztos j√≥ f√°jlt v√°lasztott√°l?");
                }
            };
            reader.readAsText(file);
            input.value = ''; // Reset input
        }

        // --- Seg√©df√ºggv√©nyek ---
        function extractVideoID(url) {
            var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            var match = url.match(regExp);
            return (match && match[2].length == 11) ? match[2] : null;
        }

        function formatTime(s) {
            if(isNaN(s)) return "00:00";
            const m = Math.floor(s / 60);
            const sec = Math.floor(s % 60);
            return (m<10?"0"+m:m) + ":" + (sec<10?"0"+sec:sec);
        }

        function changeSpeed(delta) {
            let r = player.getPlaybackRate();
            let n = Math.max(0.25, Math.min(2.0, r + delta));
            // Kerek√≠t√©s 1 tizedesre a sz√©p megjelen√≠t√©shez
            n = Math.round(n * 100) / 100;
            player.setPlaybackRate(n);
            document.getElementById('speed-val').innerText = n;
        }

        function skip(sec) {
            player.seekTo(player.getCurrentTime() + sec);
        }
        
        function togglePlay() {
            const state = player.getPlayerState();
            if(state === 1) player.pauseVideo(); else player.playVideo();
        }

    </script>
</body>
</html>
